/**
 * Created by Yaphet on 2017/5/6.
 */
var lnglats=[];
var title=[];
var img=[];
var id=[];
var author=[];
var timeInfo=[];
function GetAjaxMapData() {
    $.ajax({
        timeout: 2000,//请求超时时间（毫秒）
        type: 'GET',
        async: true,//异步
        dataType: "json",//返回json格式的数据
        url: "Map.php",
        success: function (data) {
            var list=data.list;
            $.each(list, function (i, n) {
                lnglats[i]=n["coordinate"].split(',');
                id[i]=n["id"];
                img[i]=n["img"];
                title[i]=n["title"];
                author[i]=n["author"];
                timeInfo[i]=n["timeInfo"];
            });

//                for(var i=0;i<list.length;i++){
//                    lnglats[i]=list[i].coordinate;
//                }

            for (var i = 0; i < lnglats.length; i++) {
//                    console.log(img[i]);
                var marker = new AMap.Marker({
                    position: lnglats[i],
                    map: map,
                    icon: new AMap.Icon({
                        size: new AMap.Size(40, 50),  //图标大小
                        image: "img/asd.png",
                        imageOffset: new AMap.Pixel(0, -60)
                    })
                });
                marker.content = "<img width='200' height='120'  src='"+img[i]+"'></br>" + '<a href=' + 'details3.html?id=' + id[i] + '><p>'+title[i]+'</p></a>';//+ '标注' + lnglats[i]
                marker.on('click', markerClick);
//                    marker.emit('click', {target: marker});//初始显示的图标内容
                marker.on('click', function () {
                    map.panTo([e.target.getPosition()['lng'],e.target.getPosition()['lat']]);
                });
            }
        }
    });
}

$(document).ready(function () {
    GetAjaxMapData();
})


//地图加载
var map = new AMap.Map("mapContent", {
    resizeEnable: true,
    zoom: 13,
//        center: [116.397428, 39.90923]
});
map.on('complete', function() {
    $("input#tipinput").css('display','inline-block');
    $("a#tipinputIcon").css('display','inline-block');
    $("#satellLayer").css('display','block');
});

//    var  lnglats= [
//        [117.104554, 30.504444],
//        [112.990519, 28.253532],
//        [112.979532, 28.103426],
//        [112.818857, 28.344219]
//    ];

// 初始化地图对象，加载地图
var infoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, -30)});
//    for (var i = 0, marker; i < lnglats.length; i++) {
//        var marker = new AMap.Marker({
//            position: lnglats[i],
//            map: map,
//            icon: new AMap.Icon({
//                size: new AMap.Size(40, 50),  //图标大小
//                image: "img/asd.png",
//                imageOffset: new AMap.Pixel(0, -60)
//            })
//        });
//        marker.content = "<img width='200' height='120'  src='img/pic/14985868676_b51baa4071_h.jpg'></br>" + '标注' + lnglats[i] + '<a href=' + 'details2.html' + '><p>长沙师范学院</p></a>';
//        marker.on('click', markerClick);
//        marker.emit('click', {target: marker});
//        marker.on('click', function (e) {
//            map.panTo([e.target.getPosition()['lng'],e.target.getPosition()['lat']]);
//        });
//    }

//    var t = 0;
//    setInterval(function () {
//        console.log(lnglats[t]);
//        map.panTo(lnglats[t]);
//        var marker = new AMap.Marker({
//            position: lnglats[t],
//            map: map,
//            icon: new AMap.Icon({
//                size: new AMap.Size(40, 50),  //图标大小
//                image: "img/asd.png",
//                imageOffset: new AMap.Pixel(0, -60)
//            })
//        });
//        marker.content = "<img width='200' height='120'  src='img/pic/14985868676_b51baa4071_h.jpg'></br>" + '标注' + lnglats[t] + '<a href=' + 'details2.html' + '><p>长沙师范学院</p></a>';
//        marker.on('click', markerClick);
//        marker.emit('click', {target: marker});
//        t++;
//        if (t == lnglats.length) {
//            t = 0;
//        }
//    }, 5000);

function markerClick(e) {
    infoWindow.setContent(e.target.content);
    infoWindow.open(map, e.target.getPosition());
}




/**
 * 搜索查询功能
 * @type {AMap.TileLayer.Satellite}
 */
//输入提示
var autoOptions = {
    input: "tipinput"
};
var auto = new AMap.Autocomplete(autoOptions);
var placeSearch = new AMap.PlaceSearch({
    map: map
});

//构造地点查询类
AMap.event.addListener(auto, "select", select);//注册监听，当选中某条记录时会触发
function select(e) {
    placeSearch.setCity(e.poi.adcode);
    placeSearch.search(e.poi.name);  //关键字查询查询
}




/**
 * 更改地图主题
 * @type {AMap.TileLayer.Satellite}
 */
map.setMapStyle("light");//normal,light,blue_night,dark,fresh



/**
 * 绘制覆盖物
 * @type {AMap.TileLayer.Satellite}
 */
var polygonOptions = {
    map: map,
    strokeColor: '#97EC71',
    strokeWeight: 0,
    fillColor: '#D1B3E3',
    fillOpacity: 0.7
};
// 外多边形坐标数组和内多边形坐标数组
var pointers = {
    outer: [
        [112.978637,28.247013],
        [112.978862,28.246588],
        [112.982927,28.243787],
        [112.985566,28.24219],
        [112.987671,28.241153],
        [112.991061,28.240397],
        [112.99325,28.240472],
        [112.995953,28.240964],
        [112.997455,28.241134],
        [113.00533,28.242514],
        [113.009107,28.242987],
        [113.010952,28.243667],
        [113.013205,28.243818],
        [113.018934,28.241815],
        [113.021402,28.241182],
        [113.021917,28.241163],
        [113.023558,28.240548],
        [113.025167,28.240445],
        [113.026444,28.239877],
        [113.026927,28.23896],
        [113.027088,28.236909],
        [113.026873,28.235274],
        [113.025414,28.231332],
        [113.025436,28.231332],
        [113.024964,28.230557],
        [113.024089,28.229357],
        [113.023515,28.228955],
        [113.022496,28.227825],
        [113.021439,28.227007],
        [113.021069,28.226955],
        [113.02093,28.2268],
        [113.020227,28.226289],
        [113.020152,28.22619],
        [113.019025,28.22549],
        [113.018462,28.225093],
        [113.015801,28.223869],
        [113.011338,28.221293],
        [113.010399,28.220834],
        [113.009777,28.220357],
        [113.009278,28.219709],
        [113.009208,28.219236],
        [113.009283,28.218664],
        [113.009492,28.218211],
        [113.009948,28.217728],
        [113.010528,28.21744],
        [113.011284,28.217341],
        [113.011568,28.217213],
        [113.013183,28.217454],
        [113.013371,28.217572],
        [113.013392,28.217762],
        [113.014766,28.218267],
        [113.014809,28.218414],
        [113.014927,28.218418],
        [113.015023,28.21838],
        [113.015136,28.218428],
        [113.015238,28.21838],
        [113.015297,28.218461],
        [113.01526,28.218522],
        [113.015453,28.218551],
        [113.015555,28.218475],
        [113.01563,28.21847],
        [113.015673,28.218522],
        [113.015817,28.218546],
        [113.01585,28.21865],
        [113.015978,28.218678],
        [113.015973,28.218612],
        [113.016048,28.218579],
        [113.016171,28.21864],
        [113.016262,28.218687],
        [113.016439,28.218659],
        [113.016536,28.218697],
        [113.016563,28.218791],
        [113.016707,28.218796],
        [113.01674,28.218758],
        [113.017002,28.218777],
        [113.017163,28.218872],
        [113.017217,28.218825],
        [113.01734,28.218872],
        [113.017378,28.218981],
        [113.018354,28.219127],
        [113.018783,28.219245],
        [113.018955,28.219165],
        [113.019277,28.219175],
        [113.019346,28.219104],
        [113.019443,28.219095],
        [113.019496,28.219113],
        [113.019507,28.219147],
        [113.019416,28.219147],
        [113.019416,28.219199],
        [113.019485,28.219194],
        [113.019502,28.219232],
        [113.019142,28.219284],
        [113.019126,28.219345],
        [113.02081,28.219695],
        [113.021336,28.219728],
        [113.022173,28.220073],
        [113.024984,28.220139],
        [113.026524,28.220007],
        [113.028321,28.219638],
        [113.028728,28.219345],
        [113.034602,28.217057],
        [113.036303,28.216235],
        [113.038202,28.215516],
        [113.039919,28.215048],
        [113.041062,28.214315],
        [113.041711,28.213398],
        [113.042553,28.209843],
        [113.04243,28.2092],
        [113.045155,28.198918],
        [113.048009,28.194304],
        [113.048824,28.193334],
        [113.049457,28.191878],
        [113.05031,28.190724],
        [113.052005,28.18949],
        [113.052746,28.189183],
        [113.057955,28.186166],
        [113.058759,28.185183],
        [113.059843,28.18471],
        [113.062327,28.183084],
        [113.064526,28.181419],
        [113.066071,28.17992],
        [113.068276,28.178085],
        [113.073351,28.17518],
        [113.076618,28.174319],
        [113.077197,28.174646],
        [113.077272,28.174612],
        [113.077326,28.174338],
        [113.077498,28.174239],
        [113.078729,28.174079],
        [113.08021,28.173672],
        [113.081277,28.173544],
        [113.084619,28.173705],
        [113.08588,28.174168],
        [113.086888,28.174301],
        [113.089388,28.175237],
        [113.09059,28.175516],
        [113.092698,28.176211],
        [113.093111,28.176638],
        [113.092923,28.177432],
        [113.092913,28.177971],
        [113.093063,28.177896],
        [113.09332,28.17669],
        [113.093696,28.176713],
        [113.094946,28.177371],
        [113.098121,28.179262],
        [113.098685,28.179702],
        [113.101506,28.18174],
        [113.106404,28.182818],
        [113.107128,28.182804],
        [113.107504,28.183064],
        [113.107665,28.183589],
        [113.108081,28.183868],
        [113.107829,28.183366],
        [113.107898,28.182865],
        [113.108757,28.182402],
        [113.110033,28.181423],
        [113.110768,28.180719],
        [113.111283,28.179919],
        [113.111648,28.179674],
        [113.111683,28.179148],
        [113.112037,28.178638],
        [113.112332,28.177815],
        [113.113904,28.175261],
        [113.114247,28.175022],
        [113.114869,28.174227],
        [113.115942,28.171967],
        [113.116248,28.171853],
        [113.116672,28.172307],
        [113.118029,28.172241],
        [113.117949,28.172189],
        [113.116731,28.172198],
        [113.116468,28.171796],
        [113.11605,28.171626],
        [113.115835,28.171437],
        [113.115669,28.170397],
        [113.115095,28.16903],
        [113.114564,28.168529],
        [113.114016,28.167947],
        [113.113507,28.16755],
        [113.112429,28.167167],
        [113.110524,28.166661],
        [113.109081,28.16649],
        [113.108647,28.16659],
        [113.106657,28.167408],
        [113.103052,28.169215],
        [113.099125,28.170549],
        [113.097166,28.170863],
        [113.095063,28.170735],
        [113.092263,28.169676],
        [113.091518,28.169506],
        [113.089742,28.168584],
        [113.082861,28.163523],
        [113.079578,28.159957],
        [113.078237,28.157848],
        [113.07716,28.15851],
        [113.077943,28.159915],
        [113.07892,28.161504],
        [113.08099,28.1635],
        [113.082251,28.164462],
        [113.082465,28.164778],
        [113.083694,28.165828],
        [113.088656,28.169172],
        [113.090957,28.170496],
        [113.093344,28.171442],
        [113.095018,28.171782],
        [113.098543,28.171645],
        [113.100769,28.170983],
        [113.104202,28.16972],
        [113.105152,28.169262],
        [113.10594,28.168576],
        [113.10741,28.167975],
        [113.110103,28.167677],
        [113.111315,28.167725],
        [113.112442,28.167919],
        [113.113665,28.168775],
        [113.114109,28.169365],
        [113.114426,28.169989],
        [113.114108,28.169368],
        [113.114811,28.171051],
        [113.114848,28.172172],
        [113.114473,28.1729],
        [113.113647,28.17378],
        [113.113207,28.174437],
        [113.11207,28.176579],
        [113.111544,28.177269],
        [113.111061,28.178253],
        [113.109479,28.180291],
        [113.108953,28.180759],
        [113.10767,28.181657],
        [113.107176,28.181761],
        [113.106361,28.181809],
        [113.105567,28.181686],
        [113.103019,28.181005],
        [113.100761,28.180073],
        [113.097488,28.177364],
        [113.096448,28.176716],
        [113.092263,28.174754],
        [113.090718,28.174248],
        [113.088862,28.173775],
        [113.08809,28.173418],
        [113.086744,28.173215],
        [113.083171,28.172231],
        [113.082796,28.172201],
        [113.080049,28.172702],
        [113.076439,28.173156],
        [113.073811,28.173837],
        [113.071718,28.174693],
        [113.069846,28.17569],
        [113.068763,28.17613],
        [113.065356,28.178291],
        [113.063548,28.180107],
        [113.062744,28.180864],
        [113.06217,28.18137],
        [113.06217,28.18137],
        [113.05098,28.188859],
        [113.049918,28.190341],
        [113.049285,28.190657],
        [113.043985,28.19921],
        [113.04259,28.20303],
        [113.039961,28.21301],
        [113.039173,28.214002],
        [113.038223,28.214541],
        [113.03707,28.214825],
        [113.035863,28.215274],
        [113.031073,28.21725],
        [113.027339,28.218535],
        [113.026942,28.218559],
        [113.026497,28.218663],
        [113.026282,28.218786],
        [113.026202,28.218994],
        [113.025703,28.218961],
        [113.022484,28.218918],
        [113.021299,28.218668],
        [113.020784,28.218602],
        [113.019491,28.218275],
        [113.016342,28.217467],
        [113.016025,28.2175],
        [113.015891,28.217415],
        [113.015848,28.217373],
        [113.014974,28.217207],
        [113.014781,28.21707],
        [113.014287,28.21698],
        [113.014089,28.216905],
        [113.014014,28.216805],
        [113.013949,28.216772],
        [113.01388,28.216801],
        [113.013584,28.21669],
        [113.013423,28.21669],
        [113.012973,28.21651],
        [113.012726,28.216647],
        [113.012452,28.216624],
        [113.012298,28.216721],
        [113.012186,28.216646],
        [113.0121,28.216674],
        [113.011665,28.216556],
        [113.011654,28.21648],
        [113.011703,28.216414],
        [113.01203,28.216353],
        [113.012046,28.216295],
        [113.01218,28.21629],
        [113.012261,28.216333],
        [113.012486,28.216413],
        [113.012642,28.216248],
        [113.01262,28.216205],
        [113.012524,28.216253],
        [113.012368,28.216224],
        [113.012325,28.216167],
        [113.012277,28.216163],
        [113.01218,28.216229],
        [113.011848,28.216234],
        [113.011885,28.216319],
        [113.011776,28.216351],
        [113.01168,28.216323],
        [113.011363,28.216427],
        [113.011261,28.216314],
        [113.011202,28.216408],
        [113.010923,28.216285],
        [113.010832,28.216403],
        [113.010425,28.216422],
        [113.010044,28.216692],
        [113.009572,28.217037],
        [113.009287,28.217098],
        [113.009287,28.217098],
        [113.008713,28.217727],
        [113.00859,28.217793],
        [113.008343,28.2181],
        [113.008289,28.218233],
        [113.008343,28.218332],
        [113.008225,28.218412],
        [113.007914,28.218483],
        [113.008107,28.218483],
        [113.008241,28.218639],
        [113.008247,28.218866],
        [113.008118,28.218871],
        [113.008039,28.218945],
        [113.008045,28.219025],
        [113.00812,28.219087],
        [113.008114,28.219143],
        [113.008039,28.219124],
        [113.008034,28.21928],
        [113.008163,28.21937],
        [113.008104,28.219432],
        [113.008136,28.219517],
        [113.008152,28.219725],
        [113.008286,28.22016],
        [113.008448,28.220331],
        [113.008544,28.22035],
        [113.00856,28.22044],
        [113.008517,28.220473],
        [113.008606,28.220601],
        [113.008558,28.220658],
        [113.008676,28.220837],
        [113.009041,28.221069],
        [113.008998,28.221041],
        [113.009695,28.221386],
        [113.010409,28.221627],
        [113.011042,28.221929],
        [113.011449,28.222294],
        [113.013115,28.223433],
        [113.013206,28.223404],
        [113.013319,28.223494],
        [113.013351,28.223556],
        [113.014794,28.224392],
        [113.014923,28.224406],
        [113.015068,28.224534],
        [113.015567,28.224784],
        [113.015722,28.224799],
        [113.016339,28.225134],
        [113.018818,28.226817],
        [113.019263,28.226822],
        [113.019472,28.226982],
        [113.019615,28.227039],
        [113.019809,28.227223],
        [113.019851,28.227408],
        [113.020002,28.227412],
        [113.020093,28.227351],
        [113.020195,28.227351],
        [113.020248,28.227299],
        [113.020447,28.227464],
        [113.020517,28.227621],
        [113.020432,28.22763],
        [113.020379,28.227531],
        [113.020259,28.227477],
        [113.020146,28.227515],
        [113.020082,28.227709],
        [113.020195,28.227728],
        [113.021171,28.22855],
        [113.021246,28.228555],
        [113.021316,28.228711],
        [113.021634,28.228922],
        [113.021704,28.228879],
        [113.022718,28.22965],
        [113.02356,28.2306],
        [113.024434,28.23198],
        [113.025078,28.233615],
        [113.025749,28.236021],
        [113.025942,28.237486],
        [113.025674,28.239083],
        [113.025505,28.239296],
        [113.025183,28.239504],
        [113.024802,28.239674],
        [113.022093,28.240015],
        [113.019057,28.240549],
        [113.0169,28.24121],
        [113.01675,28.241214],
        [113.016685,28.241162],
        [113.01661,28.241167],
        [113.015956,28.241474],
        [113.01661,28.241167],
        [113.0158,28.241507],
        [113.015468,28.241706],
        [113.015419,28.241843],
        [113.014947,28.242022],
        [113.014803,28.241956],
        [113.014679,28.24172],
        [113.014325,28.241857],
        [113.014239,28.241939],
        [113.013788,28.242119],
        [113.013702,28.242246],
        [113.013729,28.242336],
        [113.013842,28.242379],
        [113.013895,28.242483],
        [113.013826,28.242587],
        [113.012994,28.242747],
        [113.012399,28.242747],
        [113.012216,28.242506],
        [113.012039,28.242426],
        [113.010876,28.242458],
        [113.004423,28.241143],
        [112.999863,28.240416],
        [112.995282,28.23948],
        [112.994317,28.239404],
        [112.993705,28.239246],
        [112.993029,28.239133],
        [112.991661,28.239152],
        [112.988946,28.239483],
        [112.987074,28.240187],
        [112.98297,28.24246],
        [112.979129,28.245078],
        [112.978464,28.245295],
        [112.978121,28.245352],
        [112.977941,28.245267],
        [112.978637,28.247013]
    ]
};
var pathArray = [
    pointers.outer
];
map.setFitView();
var polygon = new AMap.Polygon(polygonOptions);
polygon.setPath(pathArray);

var polygonArr = new Array();//多边形覆盖物节点坐标数组
polygonArr.push([113.085634,28.298082]);
polygonArr.push([113.088933,28.298512]);
polygonArr.push([113.091975,28.296773]);
polygonArr.push([113.08976,28.292646]);
polygonArr.push([113.087416,28.293014]);
polygonArr.push([113.088065,28.296179]);
polygonArr.push([113.085539,28.297388]);
var  polygon2 = new AMap.Polygon({
    path: polygonArr,//设置多边形边界路径
    strokeColor: "#FF33FF", //线颜色
    strokeOpacity: 0.2, //线透明度
    strokeWeight: 3,    //线宽
    fillColor: "#1791fc", //填充色
    fillOpacity: 0.35//填充透明度
});
polygon2.setMap(map);



/**
 * 卫星视图
 * @type {AMap.TileLayer.Satellite}
 */
var satellLayer = new AMap.TileLayer.Satellite({zIndex:10}); //实例化卫星图
function showSatellLayer () {
    satellLayer.setMap(map);   //在map中添加卫星图
    satellLayer.show();    //显示卫星图
}

function hideSatellLayer() {
    satellLayer.setMap(null);   //隐藏卫星图
    satellLayer.hide();   //隐藏卫星图
}

$("#satellLayer").toggle(
    function () {
        showSatellLayer();
        $(this).addClass('active');
    },
    function () {
        hideSatellLayer();
        $(this).removeClass('active');
    }
)